{% extends "layout.html" %}

{% block content %}

<div class="card">
    <h2>OPD Register</h2>
    <p class="muted">
        View OPD records for today or any selected date range
    </p>

    <form method="GET" action="/opd_by_date" class="date-form">
        <div class="date-group">
            <label>From</label>
            <input type="date" name="from_date" required>
        </div>

        <div class="date-group">
            <label>To</label>
            <input type="date" name="to_date" required>
        </div>

        <button type="submit" class="btn">
            View OPD
        </button>
    </form>
</div>

<div class="card">
    <h2>ü©∫ Today's OPD</h2>
    <p class="muted">
        Total Patients Today: <b>{{ count }}</b>
    </p>
<div class="stats-row">
    <div class="stat-card">
        <span class="label">Total Fee</span>
        <span class="value">‚Çπ {{ total_fee_today }}</span>
    </div>

    <div class="stat-card">
        <span class="label">Cash</span>
        <span class="value green">‚Çπ {{ cash_today }}</span>
    </div>

    <div class="stat-card">
        <span class="label">UPI</span>
        <span class="value blue">‚Çπ {{ upi_today }}</span>
    </div>

    <div class="stat-card">
        <span class="label">Collected</span>
        <span class="value dark">‚Çπ {{ total_collected_today }}</span>
    </div>

    <div class="stat-card">
        <span class="label">New Credit Lended</span>
        <span class="value red">‚Çπ {{ credit_today }}</span>
    </div>
</div>

    {% if visits %}
    <div class="table-wrapper">
    <table class="opd-table">
        <thead>
            <tr>
                <th>Time</th>
                <th>ID</th>
                <th>Name</th>
                <th>Age</th>
                <th>Village</th>
                <th>Mobile</th>
                <th>‚Çπ</th>
                <th>Paid</th>
                <th>Bal</th>
                <th>Mode</th>
                <th></th>
            </tr>
        </thead>

        <tbody>
        {% for v in visits %}
            {% set balance = (v[8] or 0) - (v[9] or 0) %}
            <tr>
                <td class="time">{{ v[1] }}</td>

                <td><span class="pid">P-{{ v[2] }}</span></td>

                <td class="name">{{ v[3] }}</td>

                <td>{{ v[4] }}</td>

                <td class="address">{{ v[6] or "‚Äî" }}</td>

                <td>{{ v[7] }}</td>

                <td>‚Çπ{{ v[8] or 0 }}</td>

                <td>‚Çπ{{ v[9] or 0 }}</td>

                <td class="{% if balance > 0 %}credit{% elif balance < 0 %}paid{% else %}neutral{% endif %}">
                    ‚Çπ{{ balance }}
                </td>

                <td>
                    {% if v[10] == "UPI" %}
                        UPI
                    {% elif v[10] == "CASH" %}
                        CASH
                    {% else %}
                        ‚Äî
                    {% endif %}
                </td>

                <td>
                    <a href="/history/{{ v[2] }}" class="btn-link">View</a>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

    {% else %}
        <p class="muted">No OPD visits today.</p>
    {% endif %}
</div>

<a href="/" class="back-link">‚Üê Back to Home</a>

{% endblock %}
